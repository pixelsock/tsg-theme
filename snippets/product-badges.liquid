{%- comment -%}
  ----------------------------------------------------------------------------------------------------------------------
  PRODUCT BADGES COMPONENT
  ----------------------------------------------------------------------------------------------------------------------

  This component is used in product listing and product page to render the badges of a given product

  ********************************************
  Supported variables
  ********************************************

  * product: the product to render the badges
  * variant: the specific variant to show the badge from
  * vertical: if set to true, the badges are outputted vertically
  * types: the types of badge to output. Can be "custom", "sold_out" or "discount" (or a combination separated by comma). If nothing is set, all badges are outputted.
  * form_id: an optional form ID to use to update the badges when a given variant changes
{%- endcomment -%}

{%- liquid
  assign badge_types = types | default: 'custom, sold_out, discount' | split: ','
  assign variant = variant | default: product.selected_or_first_available_variant
-%}

{%- assign is_badge_list_hidden = true -%}
{%- assign sold_out_badge_present = false -%}

{%- for badge_type in badge_types -%}
  {%- assign stripped_badge_type = badge_type | strip -%}
  {%- if stripped_badge_type == 'sold_out' and settings.show_sold_out_badge -%}
    {%- if variant.available == false or form_id != blank -%}
      {%- assign sold_out_badge_present = true -%}
    {%- endif -%}
  {%- endif -%}  
{%- endfor -%}

{%- capture badges -%}
  {%- if sold_out_badge_present -%}
    {%- unless variant.available -%}
      {%- assign is_badge_list_hidden = false -%}
    {%- endunless -%}
    <sold-out-badge {% if variant.available %}hidden{% endif %} {% if form_id != blank %}form="{{ form_id }}"{% endif %} class="badge badge--sold-out">
      {{- 'product.general.sold_out_badge' | t -}}
    </sold-out-badge>
    {%- endif -%}
{%- endcapture -%}

{%- if badges != blank -%}
  <badge-list
    {% if form_id != blank and is_badge_list_hidden %}
      hidden
    {% endif %}
    class="badge-list {% if vertical %}badge-list--vertical{% endif %}"
  >
    {{- badges -}}
  </badge-list>
{%- endif -%}
